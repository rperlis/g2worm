$def with (resultx, drugdatax)

<style>
.axis path,
.axis line {
    fill: none;
    stroke: #eee;
    shape-rendering: crispEdges;
}
 
.axis text {
    font-family: sans-serif;
    font-size: 11px;
}
 
.loading {
    font-family: sans-serif;
    font-size: 15px;
}
 
.circle {
    fill: #222;
}
</style>
 
<h1>CNS effect calculator</h1>
<br>
<h2>Similarity for drug:  
<strong>$:resultx %</strong></p></h2>
<h2>To class:  
<strong>$:resultx %</strong></p></h2>

<label>X-axis</label>
<select id="refpop" name="refpop">
 <option value=0 selected>Molecular weight</option>
 <option value=1>LogP</option>

</select>
 
<div id="punchcard"></div>
 
<script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>

<script type="text/javascript">
var druginput=$:drugdatax;


var w = 940,
    h = 300,
    pad = 20,
    left_pad = 100,
    Data_url = '/static/data.json',
    Tsv_url = '/static/drugdata.txt';
 
var svg = d3.select("#punchcard")
        .append("svg")
        .attr("width", w)
        .attr("height", h);
 
var x = d3.scale.linear().domain([0, 23]).range([left_pad, w-pad]),
    y = d3.scale.linear().domain([0, 6]).range([pad, h-pad*2]);
 

var xAxis = d3.svg.axis().scale(x).orient("bottom")
        .ticks(24)
        .tickFormat(function (d, i) {
            var m = (d> 12) ? "p" : "a";
            return (d%12 == 0) ? 12+m :  d%12+m;
        }),
    yAxis = d3.svg.axis().scale(y).orient("left")
        .ticks(20)
        .tickFormat(function (d, i) {
            return 20-i;
        });
 
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0, "+(h-pad)+")")
    .call(xAxis);
 
svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate("+(left_pad-pad)+", 0)")
    .call(yAxis);
 
svg.append("text")
    .attr("class", "loading")
    .text("Loading ...")
    .attr("x", function () { return w/2; })
    .attr("y", function () { return h/2-5; });

var tsvdata=d3.tsv(Tsv_url,function(tsv2) {
  alert("nose"+tsv2);
});

tsvrows=d3.tsv.parseRows(tsvdata);
alert(tsvrows);

d3.json(Data_url, function (punchcard_data) {
    var max_r = d3.max(punchcard_data.map(
                       function (d) { return d[2]; })),
        r = d3.scale.linear()
            .domain([0, d3.max(punchcard_data, function (d) { return d[2]; })])
            .range([0, 12]);
 
    svg.selectAll(".loading").remove();
 
    svg.selectAll("circle")
        .data(punchcard_data)
        .enter()
        .append("circle")
        .attr("class", "circle")
        .attr("cx", function (d) { return x(d[1]); })
        .attr("cy", function (d) { return y(d[0]); })
        .transition()
        .duration(800)
        .attr("r", function (d) { return r(d[2]); });
});



</script>



